<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PDF Nastaliq â€“ Ù…ÙØª Ø§Ø±Ø¯Ùˆ Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ø³Ø§Ø² | Free Urdu Assignment Maker</title>
    <meta name="description" content="Ø§Ø±Ø¯Ùˆ Ù…ÛŒÚº Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ù„Ú©Ú¾ÛŒÚº Ø§ÙˆØ± ÙÙˆØ±ÛŒ PDF Ø¨Ù†Ø§Ø¦ÛŒÚºÛ” Ù†Ø³ØªØ¹Ù„ÛŒÙ‚ ÙÙˆÙ†Ù¹ØŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ø­ÙÙˆØ¸ØŒ Ù…Ú©Ù…Ù„ Ù…ÙØªÛ” Write Urdu assignments online with Nastaliq font and export clean PDF instantly â€” no signup needed." />
    <meta name="keywords" content="Urdu Assignment Maker, Urdu PDF Editor, Nastaliq Font Online, Free Urdu Editor, Ø§Ø±Ø¯Ùˆ Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹, Ø§Ø±Ø¯Ùˆ Ù¾ÛŒ ÚˆÛŒ Ø§ÛŒÙ, Ù†Ø³ØªØ¹Ù„ÛŒÙ‚" />
    <meta name="author" content="PDF Nastaliq" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://pdf-nastaliq.vercel.app/" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <meta property="og:title" content="PDF Nastaliq â€“ Ù…ÙØª Ø§Ø±Ø¯Ùˆ Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ø³Ø§Ø²" />
    <meta property="og:description" content="Ø§Ø±Ø¯Ùˆ Ù…ÛŒÚº Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ù„Ú©Ú¾ÛŒÚºØŒ Ù†Ø³ØªØ¹Ù„ÛŒÙ‚ ÙÙˆÙ†Ù¹ Ù…ÛŒÚº ØµØ§Ù PDF ÙÙˆØ±ÛŒ Ø¨Ù†Ø§Ø¦ÛŒÚº â€” Ø¨Ø§Ù„Ú©Ù„ Ù…ÙØªÛ”" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://pdf-nastaliq.vercel.app/" />
    <meta property="og:image" content="https://pdf-nastaliq.vercel.app/apple-touch-icon.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="PDF Nastaliq â€“ Free Urdu Assignment Maker" />
    <meta name="twitter:description" content="Write Urdu assignments in Nastaliq font, export clean PDF â€” free, no signup." />
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebApplication","name":"PDF Nastaliq","url":"https://pdf-nastaliq.vercel.app/","description":"Free online Urdu assignment maker with Nastaliq font and instant PDF export.","applicationCategory":"EducationApplication","operatingSystem":"Any","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"inLanguage":["ur","en"],"audience":{"@type":"EducationalAudience","educationalRole":"student"}}</script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
    --green:       #16a34a;
    --green-dk:    #15803d;
    --green-dp:    #14532d;
    --green-lt:    #dcfce7;
    --green-pl:    #f0fdf4;
    --amber:       #d97706;
    --red:         #dc2626;
    --red-lt:      #fee2e2;
    --bg:          #f4f0eb;
    --bg2:         #ebe5dc;
    --card:        #ffffff;
    --ink:         #1c1917;
    --ink2:        #57534e;
    --ink3:        #a8a29e;
    --border:      #e7e0d6;
    --border2:     #d6cec2;
    --urdu:        'Noto Nastaliq Urdu', serif;
    --ui:          'Outfit', sans-serif;
    --base-size:   18px;
    --base-lh:     2.2;
    --nav-h:       64px;
    --r-xl:        24px;
    --r-lg:        18px;
    --r-md:        12px;
    --r-pill:      999px;
    --safe-b:      env(safe-area-inset-bottom);
}

*, *::before, *::after { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
button, input, select { outline: none; font-family: var(--ui); }

body {
    font-family: var(--ui);
    margin: 0; padding: 0;
    background: var(--bg);
    overflow: hidden;
    color: var(--ink);
    height: 100vh;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VIEWS â€” slide animation
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#dashView, #editorView {
    position: fixed; inset: 0;
    height: 100vh; width: 100%;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                opacity   0.4s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: transform, opacity;
}
#dashView   { transform: translateX(0);    opacity: 1;   z-index: 1; }
#editorView { transform: translateX(-100%); opacity: 0;  z-index: 2; }

body.in-editor #dashView   { transform: translateX(100%);  opacity: 0; }
body.in-editor #editorView { transform: translateX(0);     opacity: 1; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARED NAV BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.top-bar {
    position: sticky; top: 0;
    height: var(--nav-h);
    background: var(--card);
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 20px; z-index: 100;
    box-shadow: 0 1px 0 var(--border), 0 4px 20px rgba(0,0,0,0.04);
    flex-shrink: 0;
}

.brand {
    display: flex; align-items: center; gap: 10px;
    font-weight: 800; font-size: 1.1rem;
    color: var(--green-dp); letter-spacing: -0.3px;
    user-select: none;
}
.brand-badge {
    background: linear-gradient(135deg, var(--green), var(--green-dk));
    color: white; padding: 4px 11px;
    border-radius: var(--r-pill);
    font-size: 0.75rem; font-weight: 700; letter-spacing: 0.3px;
}

.icon-btn {
    width: 38px; height: 38px; border-radius: 50%;
    border: none; background: transparent;
    color: var(--ink2); cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.15s, color 0.15s; flex-shrink: 0;
}
.icon-btn:hover { background: var(--bg2); color: var(--ink); }
.icon-btn svg { width: 19px; height: 19px; stroke-width: 2; }

.btn-primary {
    display: flex; align-items: center; gap: 7px;
    background: linear-gradient(135deg, var(--green), var(--green-dk));
    color: white; border: none;
    padding: 0 20px; height: 40px; border-radius: var(--r-pill);
    font-weight: 700; font-size: 0.9rem; cursor: pointer;
    box-shadow: 0 2px 12px rgba(22,163,74,0.3);
    transition: all 0.2s; white-space: nowrap;
}
.btn-primary:hover { box-shadow: 0 4px 20px rgba(22,163,74,0.4); transform: translateY(-1px); }
.btn-primary:active { transform: scale(0.97); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#dashView {
    display: flex; flex-direction: column;
    background: var(--bg);
    overflow: hidden;
}

.dash-scroll {
    flex: 1; overflow-y: auto;
    padding: 28px 24px 60px;
}

/* Section heading */
.dash-section-title {
    font-size: 0.72rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.1em;
    color: var(--ink3); margin-bottom: 14px;
}

/* Empty state */
.empty-state {
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 80px 20px; text-align: center; gap: 12px;
}
.empty-icon {
    width: 80px; height: 80px; border-radius: 24px;
    background: var(--green-lt);
    display: flex; align-items: center; justify-content: center;
    margin-bottom: 8px;
}
.empty-icon svg { width: 36px; height: 36px; stroke: var(--green); stroke-width: 1.5; fill: none; }
.empty-title { font-size: 1.15rem; font-weight: 700; color: var(--ink); }
.empty-sub   { font-size: 0.88rem; color: var(--ink3); font-family: var(--urdu); line-height: 1.9; max-width: 260px; }

/* Doc grid */
.doc-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 16px;
}

/* Doc card */
.doc-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--r-xl);
    padding: 20px;
    cursor: pointer;
    transition: box-shadow 0.2s, transform 0.2s, border-color 0.2s;
    display: flex; flex-direction: column; gap: 12px;
    position: relative;
    animation: cardIn 0.3s cubic-bezier(0.34,1.3,0.64,1) both;
}
@keyframes cardIn { from { opacity:0; transform:scale(0.95) translateY(8px); } }
.doc-card:hover {
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    transform: translateY(-3px);
    border-color: var(--green-lt);
}

.doc-card-top {
    display: flex; align-items: flex-start; justify-content: space-between; gap: 8px;
}
.doc-subject-chip {
    background: var(--green-pl); color: var(--green-dk);
    border: 1px solid var(--green-lt);
    padding: 3px 11px; border-radius: var(--r-pill);
    font-size: 0.75rem; font-weight: 700;
    font-family: var(--urdu); direction: rtl; max-width: 160px;
    overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}
.doc-menu-btn {
    width: 28px; height: 28px; border-radius: 50%;
    border: none; background: transparent;
    color: var(--ink3); cursor: pointer; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.15s, color 0.15s;
    position: relative;
}
.doc-menu-btn:hover { background: var(--red-lt); color: var(--red); }

.doc-title {
    font-family: var(--urdu); font-size: 1.05rem;
    font-weight: 700; color: var(--ink); direction: rtl;
    line-height: 1.7;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
}
.doc-title.untitled { color: var(--ink3); font-style: italic; }

.doc-school {
    font-family: var(--urdu); font-size: 0.82rem;
    color: var(--ink3); direction: rtl; line-height: 1.6;
    overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}

.doc-card-bottom {
    display: flex; align-items: center; justify-content: space-between;
    padding-top: 10px; border-top: 1px solid var(--border);
}
.doc-meta-chips { display: flex; gap: 6px; flex-wrap: wrap; }
.doc-chip {
    background: var(--bg); border: 1px solid var(--border);
    padding: 2px 9px; border-radius: var(--r-pill);
    font-size: 0.7rem; font-weight: 600; color: var(--ink2);
}
.doc-open-btn {
    background: var(--green-pl); color: var(--green-dk);
    border: 1.5px solid var(--green-lt);
    padding: 5px 14px; border-radius: var(--r-pill);
    font-size: 0.78rem; font-weight: 700;
    cursor: pointer; transition: all 0.15s;
    font-family: var(--urdu);
}
.doc-open-btn:hover { background: var(--green-lt); }

/* SEO block inside dashboard */
.seo-block {
    margin-top: 40px;
    background: var(--card); border-radius: var(--r-xl);
    border: 1px solid var(--border); padding: 24px 28px;
}
.seo-block h2 { font-size: 0.95rem; font-weight: 700; color: var(--green-dp); margin: 0 0 8px; direction: ltr; }
.seo-block p  { font-size: 0.8rem; color: var(--ink2); line-height: 1.65; margin: 0 0 10px; direction: ltr; }
.seo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
.seo-item { display: flex; align-items: flex-start; gap: 6px; font-size: 0.78rem; color: var(--ink2); line-height: 1.5; direction: ltr; }
.seo-dot  { width: 5px; height: 5px; border-radius: 50%; background: var(--green); flex-shrink: 0; margin-top: 5px; }
.seo-urdu { direction: rtl; font-family: var(--urdu); font-size: 0.88rem; color: var(--ink2); line-height: 2; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EDITOR VIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#editorView {
    display: flex; flex-direction: column;
    background: var(--bg);
    overflow: hidden;
}

.editor-nav-left  { display: flex; align-items: center; gap: 8px; }
.editor-nav-right { display: flex; align-items: center; gap: 8px; }

.doc-title-input {
    border: none; background: transparent;
    font-family: var(--urdu); font-size: 1rem; font-weight: 700;
    color: var(--ink); direction: rtl;
    padding: 4px 8px; border-radius: 8px;
    min-width: 120px; max-width: 220px;
    transition: background 0.15s;
}
.doc-title-input:focus { background: var(--bg); }
.doc-title-input::placeholder { color: var(--ink3); font-style: italic; }

.autosave-badge {
    font-size: 0.72rem; color: var(--ink3); font-weight: 500;
    display: flex; align-items: center; gap: 4px;
    transition: color 0.3s;
}
.autosave-badge.saved  { color: var(--green); }
.autosave-badge.saving { color: var(--amber); }
.autosave-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; }

/* Editor shell */
.editor-shell {
    flex: 1; display: flex;
    height: calc(100vh - var(--nav-h));
    overflow: hidden;
}

/* Sidebar */
.e-sidebar {
    width: 290px; flex-shrink: 0;
    background: var(--card);
    border-left: 1px solid var(--border);
    display: flex; flex-direction: column;
    height: 100%; z-index: 30;
    transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
}
.e-sidebar-top {
    padding: 13px 14px;
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
}
.e-sidebar-heading {
    font-size: 0.72rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.1em; color: var(--ink3);
}
.e-close-btn {
    width: 28px; height: 28px; border-radius: 50%;
    border: none; background: var(--bg); color: var(--ink2);
    cursor: pointer; display: none; align-items: center; justify-content: center;
    transition: background 0.15s;
}
.e-close-btn svg { width: 14px; height: 14px; stroke-width: 2.5; }

.e-sidebar-body { flex: 1; overflow-y: auto; padding: 12px 12px 100px; }

.s-card {
    background: var(--bg); border: 1px solid var(--border);
    border-radius: var(--r-lg); padding: 11px 12px; margin-bottom: 9px;
}
.s-card-title {
    font-size: 0.65rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.08em;
    color: var(--ink3); margin-bottom: 9px;
}
.stats-row { display: flex; gap: 7px; }
.stat-chip {
    flex: 1; background: white; border: 1px solid var(--border);
    border-radius: 10px; padding: 6px 9px;
    display: flex; align-items: center; gap: 4px;
    font-size: 0.76rem; font-weight: 600; color: var(--green-dk);
}
.stat-chip svg { flex-shrink: 0; color: var(--green); }

.field { margin-bottom: 7px; }

input[type="text"] {
    width: 100%; padding: 8px 13px;
    border: 1.5px solid var(--border); border-radius: var(--r-pill);
    font-family: var(--urdu); font-size: 0.88rem;
    line-height: 1.8; direction: rtl;
    background: white; color: var(--ink);
    transition: border-color 0.2s, box-shadow 0.2s;
}
input[type="text"]:focus {
    border-color: var(--green);
    box-shadow: 0 0 0 3px rgba(22,163,74,0.1);
}

select {
    width: 100%; padding: 8px 13px;
    border: 1.5px solid var(--border); border-radius: var(--r-pill);
    font-size: 0.8rem; direction: ltr;
    background: white; color: var(--ink); cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2357534e' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: left 13px center;
    transition: border-color 0.2s;
}
select:focus { border-color: var(--green); outline: none; }

.date-row { display: flex; gap: 6px; }
.date-row input[type="text"] { flex: 1; }
.btn-today {
    padding: 0 13px; height: 37px;
    background: var(--green-lt); color: var(--green-dk);
    border: 1.5px solid #bbf7d0; border-radius: var(--r-pill);
    cursor: pointer; font-family: var(--urdu); font-size: 0.8rem; font-weight: 600;
    white-space: nowrap; transition: background 0.15s;
}
.btn-today:hover { background: #bbf7d0; }

.slider-wrap { margin-bottom: 7px; }
.slider-row {
    display: flex; justify-content: space-between;
    font-size: 0.73rem; color: var(--ink2); margin-bottom: 6px;
}
.slider-val { font-weight: 700; color: var(--green-dk); }
input[type=range] {
    width: 100%; cursor: pointer;
    height: 5px; border-radius: 5px;
    appearance: none; background: var(--border2);
}
input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 17px; height: 17px; background: white;
    border: 2.5px solid var(--green); border-radius: 50%; cursor: pointer;
    box-shadow: 0 1px 4px rgba(22,163,74,0.3);
}

.draft-editor {
    min-height: 95px; padding: 10px 12px;
    font-family: var(--urdu); font-size: 0.88rem;
    line-height: 2; direction: rtl;
    border: 1.5px solid var(--border); border-radius: var(--r-md);
    background: white; overflow-y: auto; transition: border-color 0.2s;
}
.draft-editor:focus { border-color: var(--green); box-shadow: 0 0 0 3px rgba(22,163,74,0.1); }

.btn-clear {
    padding: 6px 13px; border: none; border-radius: var(--r-pill);
    background: var(--red-lt); color: var(--red);
    font-size: 0.76rem; font-weight: 600; font-family: var(--urdu);
    cursor: pointer; transition: background 0.15s;
}
.btn-clear:hover { background: #fecaca; }

/* Canvas */
.e-canvas {
    flex: 1; background: var(--bg);
    background-image:
        radial-gradient(circle at 15% 85%, rgba(22,163,74,0.05) 0%, transparent 45%),
        radial-gradient(circle at 85% 15%, rgba(217,119,6,0.04) 0%, transparent 45%);
    display: flex; flex-direction: column; align-items: center;
    padding: 22px 20px; overflow-y: auto; scroll-behavior: smooth;
}

/* Toolbar */
.toolbar {
    position: sticky; top: 0; z-index: 50;
    background: var(--card); border-radius: var(--r-pill);
    box-shadow: 0 4px 24px rgba(0,0,0,0.08), 0 1px 3px rgba(0,0,0,0.04);
    padding: 6px 10px; margin-bottom: 18px;
    display: flex; gap: 3px; flex-wrap: wrap; justify-content: center;
    border: 1px solid var(--border);
    width: 100%; max-width: 780px;
}
.t-btn {
    height: 32px; padding: 0 9px; border: none; background: transparent;
    border-radius: var(--r-pill); cursor: pointer;
    display: flex; align-items: center; gap: 4px;
    font-weight: 600; color: var(--ink2);
    font-size: 0.8rem; transition: all 0.15s; user-select: none;
}
.t-btn:hover { background: var(--green-pl); color: var(--green-dk); }
.t-btn svg { width: 14px; height: 14px; stroke-width: 2; flex-shrink: 0; }
.t-btn .tlbl { font-size: 0.68rem; font-weight: 500; }
.t-sep { width: 1px; background: var(--border); margin: 3px 2px; align-self: stretch; }
.t-size {
    display: flex; align-items: center;
    border: 1.5px solid var(--border); border-radius: var(--r-pill);
    overflow: hidden; background: var(--bg);
}
.t-size input[type=number] {
    border: none; background: transparent;
    width: 36px; height: 30px; text-align: center; padding: 0;
    font-size: 0.8rem; direction: ltr; color: var(--ink); font-weight: 600;
}
.t-size input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
.t-size button {
    border: none; background: transparent;
    width: 26px; height: 30px; cursor: pointer;
    font-weight: 700; color: var(--ink2); font-size: 1rem;
    transition: background 0.15s, color 0.15s;
}
.t-size button:hover { background: var(--green-pl); color: var(--green-dk); }

/* Paper */
.paper {
    background: white; width: 210mm; min-height: 297mm;
    padding: 22mm 25mm; border-radius: var(--r-xl);
    box-shadow: 0 0 0 1px var(--border), 0 8px 32px rgba(0,0,0,0.08), 0 32px 64px rgba(0,0,0,0.04);
    display: flex; flex-direction: column; flex-shrink: 0;
    -webkit-print-color-adjust: exact; print-color-adjust: exact;
}
.paper-font {
    font-family: var(--urdu); font-size: var(--base-size);
    font-weight: 700; line-height: var(--base-lh); color: #111;
}
.paper-school { text-align: center; margin-bottom: 22px; text-decoration: underline; font-size: 1.3em; direction: rtl; text-underline-offset: 5px; }
.paper-meta { border-bottom: 2px double #000; padding-bottom: 12px; margin-bottom: 28px; font-size: 1.05em; direction: rtl; }
.meta-container.standard { display: flex; justify-content: space-between; flex-wrap: wrap; }
.meta-container.simple   { display: flex; flex-direction: column; gap: 8px; }
.meta-container.simple .meta-row  { display: flex; gap: 10px; }
.meta-container.simple .meta-dash { min-width: 100px; flex: 1; }
.meta-row   { display: flex; gap: 10px; align-items: center; margin-bottom: 6px; direction: rtl; }
.meta-label { font-weight: bold; min-width: fit-content; }
.meta-dash  { border-bottom: 1px dotted #000; min-width: 100px; text-align: right; flex: 1; }
.paper-title { text-align: center; font-size: 1.55em; margin-bottom: 36px; text-decoration: underline; text-underline-offset: 8px; direction: rtl; }
#paperEditor {
    flex: 1; outline: none; min-height: 400px;
    white-space: pre-wrap; position: relative; z-index: 1;
    text-align: justify; direction: rtl;
}
#paperEditor:empty::before {
    content: 'ÛŒÛØ§Úº Ù„Ú©Ú¾Ù†Ø§ Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº...';
    color: #ccc; pointer-events: none; position: absolute; top: 0;
}
#paperEditor img, .draft-editor img { max-width: 100%; height: auto; display: block; margin: 10px auto; border-radius: 8px; }
.paper-footer {
    width: 100%; margin-top: auto; padding-top: 14px;
    border-top: 1px solid #000; text-align: center;
    font-family: var(--urdu); font-weight: bold; font-size: 1rem;
    display: none; direction: rtl;
}

/* Mobile nav */
.mob-nav {
    display: none; position: fixed; bottom: 0; left: 0;
    width: 100%; z-index: 200;
    padding: 8px 16px calc(8px + var(--safe-b));
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(12px);
    border-top: 1px solid var(--border);
    justify-content: space-around; align-items: center; gap: 4px;
}
.mob-btn {
    flex: 1; display: flex; flex-direction: column;
    align-items: center; justify-content: center; gap: 3px;
    border: none; background: transparent; cursor: pointer;
    color: var(--ink3); padding: 6px 4px; border-radius: var(--r-md);
    font-size: 0.68rem; font-weight: 500;
    transition: all 0.15s;
}
.mob-btn svg { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
.mob-btn.active { color: var(--green-dk); background: var(--green-pl); }

/* â”€â”€ TOAST â”€â”€ */
.toast {
    position: fixed; bottom: 28px; left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--green-dp); color: white;
    padding: 10px 22px; border-radius: var(--r-pill);
    font-size: 0.85rem; opacity: 0;
    transition: all 0.3s; z-index: 9999;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    font-family: var(--urdu); pointer-events: none;
}
.toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

/* â”€â”€ MODAL â”€â”€ */
.modal-bg {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,0.5); z-index: 2000;
    align-items: center; justify-content: center;
    backdrop-filter: blur(4px);
}
.modal-bg.show { display: flex; }
.modal-card {
    background: white; padding: 28px 26px; border-radius: var(--r-xl);
    width: 90%; max-width: 400px;
    box-shadow: 0 32px 64px rgba(0,0,0,0.18);
    animation: popIn 0.3s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes popIn { from { transform: scale(0.88); opacity: 0; } }
.modal-title { font-size: 1.15rem; font-weight: 800; color: var(--ink); margin-bottom: 6px; }
.modal-note {
    background: #fffbeb; border: 1px solid #fcd34d; border-radius: var(--r-md);
    padding: 11px 13px; margin: 14px 0; color: #92400e; font-size: 0.85rem;
    display: flex; gap: 8px; align-items: flex-start; direction: ltr;
}
.modal-steps { color: var(--ink2); font-size: 0.9rem; line-height: 1.7; margin-bottom: 20px; direction: ltr; }
.modal-btns  { display: flex; gap: 10px; justify-content: flex-end; }
.btn-cancel {
    padding: 10px 20px; border-radius: var(--r-pill);
    border: 1.5px solid var(--border); background: white;
    color: var(--ink2); font-weight: 600; cursor: pointer; font-size: 0.88rem;
    transition: all 0.15s;
}
.btn-cancel:hover { border-color: var(--border2); background: var(--bg); }
.btn-go {
    padding: 10px 22px; border-radius: var(--r-pill); border: none;
    background: linear-gradient(135deg, var(--green), var(--green-dk));
    color: white; font-weight: 700; cursor: pointer; font-size: 0.88rem;
    box-shadow: 0 2px 10px rgba(22,163,74,0.3); transition: all 0.15s;
}
.btn-go:hover { box-shadow: 0 4px 16px rgba(22,163,74,0.4); }

/* Delete confirm modal */
.del-modal-card {
    background: white; padding: 26px; border-radius: var(--r-xl);
    width: 90%; max-width: 360px;
    box-shadow: 0 32px 64px rgba(0,0,0,0.18);
    animation: popIn 0.3s cubic-bezier(0.34,1.56,0.64,1);
    text-align: center;
}
.del-icon { width: 56px; height: 56px; border-radius: 50%; background: var(--red-lt); display: flex; align-items: center; justify-content: center; margin: 0 auto 14px; }
.del-icon svg { width: 24px; height: 24px; stroke: var(--red); stroke-width: 2; fill: none; }
.del-title { font-size: 1.05rem; font-weight: 800; color: var(--ink); margin-bottom: 6px; }
.del-sub   { font-size: 0.85rem; color: var(--ink2); margin-bottom: 20px; font-family: var(--urdu); line-height: 1.9; }
.btn-del-confirm {
    padding: 10px 24px; border-radius: var(--r-pill); border: none;
    background: var(--red); color: white; font-weight: 700; cursor: pointer;
    font-size: 0.88rem; transition: all 0.15s;
}
.btn-del-confirm:hover { background: #b91c1c; }

/* â”€â”€ PRINT â”€â”€ */
@media print {
    @page { margin: 20mm 15mm; size: A4; }
    body { direction: rtl; background: white; height: auto; display: block; overflow: visible; }
    #dashView { display: none !important; }
    #editorView { position: static !important; transform: none !important; opacity: 1 !important; display: flex !important; }
    .top-bar, .mob-nav, .e-sidebar, .toolbar, .modal-bg, .toast { display: none !important; }
    .editor-shell { display: block; height: auto; }
    .e-canvas { padding: 0; overflow: visible; background: white; display: block; }
    .paper {
        box-shadow: none; margin: 0; padding: 0; width: 100%;
        min-height: auto; display: flex; flex-direction: column;
        border-radius: 0; border: none;
    }
    #paperEditor {
        max-height: none; overflow: visible; white-space: pre-wrap;
        line-height: var(--base-lh); text-align: justify; direction: rtl;
        font-family: 'Noto Nastaliq Urdu', serif; font-size: var(--base-size); flex: 1;
    }
    .paper-footer {
        display: block; margin-top: auto; padding-top: 10px;
        border-top: 1px solid #000; text-align: center;
        font-family: var(--urdu); font-weight: bold;
        font-size: var(--base-size); color: #000; direction: rtl;
    }
    .paper-meta, .paper-school, .paper-title { page-break-inside: avoid; break-inside: avoid; }
}

/* â”€â”€ RESPONSIVE â”€â”€ */
@media (max-width: 860px) {
    .doc-grid { grid-template-columns: 1fr 1fr; }
    .e-sidebar {
        width: 100%; position: fixed;
        top: var(--nav-h); right: 0;
        height: calc(100vh - var(--nav-h));
        transform: translateX(100%); border-right: none;
    }
    .e-close-btn { display: flex; }
    .e-canvas { width: 100%; padding: 12px; }
    .paper { width: 100%; padding: 14mm; min-height: auto; border-radius: var(--r-lg); }
    .paper-meta { flex-direction: column; gap: 4px; }
    .meta-container.standard, .meta-container.simple { flex-direction: column; }
    .mob-nav { display: flex; }
    .toolbar { border-radius: var(--r-lg); }
    .dash-scroll { padding: 16px 14px 80px; }
    .doc-title-input { max-width: 140px; }
}
@media (max-width: 500px) {
    .doc-grid { grid-template-columns: 1fr; }
    .seo-grid  { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DASHBOARD VIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="dashView">
    <header class="top-bar">
        <div class="brand">
            <span class="brand-badge">PDF</span>
            Nastaliq
        </div>
        <button class="btn-primary" onclick="newDoc()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Ù†Ø¦ÛŒ Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹
        </button>
    </header>

    <div class="dash-scroll" id="dashScroll">
        <!-- filled by JS -->
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     EDITOR VIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="editorView">
    <header class="top-bar">
        <div class="editor-nav-left">
            <button class="icon-btn" onclick="goBack()" title="ÙˆØ§Ù¾Ø³">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="15 18 9 12 15 6"/></svg>
            </button>
            <input class="doc-title-input" id="docTitleInput" type="text" placeholder="Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ú©Ø§ Ø¹Ù†ÙˆØ§Ù†..." oninput="onDocTitleInput()">
        </div>
        <div class="editor-nav-right">
            <span class="autosave-badge" id="autosaveBadge">
                <span class="autosave-dot"></span> Ù…Ø­ÙÙˆØ¸ ÛÛ’
            </span>
            <button class="icon-btn" onmousedown="toggleEditorSidebar()" title="ØªØ±ØªÛŒØ¨Ø§Øª">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><line x1="3" y1="8" x2="21" y2="8"/><line x1="3" y1="16" x2="21" y2="16"/></svg>
            </button>
            <button class="btn-primary" onmousedown="openModal()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                PDF
            </button>
        </div>
    </header>

    <div class="editor-shell">
        <div class="backdrop" id="eBackdrop" onmousedown="toggleMobile('preview')"></div>

        <!-- SIDEBAR -->
        <aside class="e-sidebar" id="eSidebar">
            <div class="e-sidebar-top">
                <span class="e-sidebar-heading">ØªØ±ØªÛŒØ¨Ø§Øª</span>
                <button class="e-close-btn" onmousedown="toggleMobile('preview')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="e-sidebar-body">

                <div class="s-card">
                    <div class="s-card-title">Ø´Ù…Ø§Ø±ÛŒØ§Øª</div>
                    <div class="stats-row">
                        <div class="stat-chip">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/></svg>
                            <span id="wordCount">0</span>&nbsp;Ø§Ù„ÙØ§Ø¸
                        </div>
                        <div class="stat-chip">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg>
                            <span id="charCount">0</span>&nbsp;Ø­Ø±ÙˆÙ
                        </div>
                    </div>
                </div>

                <div class="s-card">
                    <div class="s-card-title">ÛÛŒÚˆØ± Ú©ÛŒ ØªØ±ØªÛŒØ¨</div>
                    <select id="headerLayoutSelect" onchange="updateHeaderLayout()">
                        <option value="standard">Ø¯Ùˆ Ú©Ø§Ù„Ù… â€” Ø¨Ø§Ø¦ÛŒÚº Ùˆ Ø¯Ø§Ø¦ÛŒÚº</option>
                        <option value="simple">Ø§ÛŒÚ© Ú©Ø§Ù„Ù… â€” Ø§ÙˆÙ¾Ø± Ø³Û’ Ù†ÛŒÚ†Û’</option>
                    </select>
                </div>

                <div class="s-card">
                    <div class="s-card-title">Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ú©ÛŒ ØªÙØµÛŒÙ„</div>
                    <div class="field"><input type="text" id="inSchool"    placeholder="Ø§Ø¯Ø§Ø±Û’ / ÛŒÙˆÙ†ÛŒÙˆØ±Ø³Ù¹ÛŒ Ú©Ø§ Ù†Ø§Ù…"  oninput="syncMeta()"></div>
                    <div class="field"><input type="text" id="inSubject"   placeholder="Ù…Ø¶Ù…ÙˆÙ† â€” Subject"            oninput="syncMeta()"></div>
                    <div class="field"><input type="text" id="inName"      placeholder="Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ø§ Ù†Ø§Ù…"            oninput="syncMeta()"></div>
                    <div class="field"><input type="text" id="inSemester"  placeholder="Ø¬Ù…Ø§Ø¹Øª / Ø³Ù…Ø³Ù¹Ø±"              oninput="syncMeta()"></div>
                    <div class="field"><input type="text" id="inRoll"      placeholder="Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±"                   oninput="syncMeta()"></div>
                    <div class="field">
                        <div class="date-row">
                            <input type="text" id="inDate" placeholder="ØªØ§Ø±ÛŒØ®" oninput="syncMeta()">
                            <button class="btn-today" type="button" onmousedown="setToday()">Ø¢Ø¬</button>
                        </div>
                    </div>
                    <div class="field"><input type="text" id="inTitle" placeholder="Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ú©Ø§ Ø¹Ù†ÙˆØ§Ù†" oninput="syncMeta()"></div>
                </div>

                <div class="s-card">
                    <div class="s-card-title">ÙÙˆÙ¹Ø±</div>
                    <div class="field"><input type="text" id="inFooter" placeholder="Ø§Ù¾Ù†Ø§ ÙÙˆÙ¹Ø± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)" oninput="syncMeta()"></div>
                    <p style="font-size:0.7rem;color:var(--ink3);margin:0;direction:rtl;font-family:var(--urdu);line-height:1.8">Ø®Ø§Ù„ÛŒ Ø±ÛÙ†Û’ Ù¾Ø± ØªØ§Ø±ÛŒØ® Ø§ÙˆØ± Ø§Ø¯Ø§Ø±Û’ Ú©Ø§ Ù†Ø§Ù… Ø®ÙˆØ¯ Ø¢Ø¦Û’ Ú¯Ø§</p>
                </div>

                <div class="s-card">
                    <div class="s-card-title">Ø®Ø· Ø§ÙˆØ± Ø³Ø·Ø±</div>
                    <div class="slider-wrap">
                        <div class="slider-row"><span>ÙÙˆÙ†Ù¹ Ø³Ø§Ø¦Ø²</span><span class="slider-val" id="sizeVal">18px</span></div>
                        <input type="range" id="sizeRange" min="12" max="32" value="18" oninput="updateBaseSettings()">
                    </div>
                    <div class="slider-wrap">
                        <div class="slider-row"><span>Ø³Ø·Ø±ÙˆÚº Ú©Ø§ ÙØ§ØµÙ„Û</span><span class="slider-val" id="lineVal">2.2</span></div>
                        <input type="range" id="lineRange" min="1.5" max="3.0" step="0.1" value="2.2" oninput="updateBaseSettings()">
                    </div>
                </div>

                <div class="s-card">
                    <div class="s-card-title">ÙÙˆØ±ÛŒ Ù…Ø³ÙˆØ¯Û</div>
                    <div id="sidebarEditor" class="draft-editor" contenteditable="true" spellcheck="false" oninput="handleInput('sidebar')"></div>
                    <div style="text-align:left;margin-top:7px;">
                        <button class="btn-clear" onclick="clearContent()">Ù…ÙˆØ§Ø¯ ØµØ§Ù Ú©Ø±ÛŒÚº</button>
                    </div>
                </div>
            </div>
        </aside>

        <!-- CANVAS -->
        <main class="e-canvas">
            <div class="toolbar">
                <button class="t-btn" type="button" onmousedown="event.preventDefault(); exec('undo')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg>
                </button>
                <button class="t-btn" type="button" onmousedown="event.preventDefault(); exec('redo')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 7v6h-6"/><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"/></svg>
                </button>
                <div class="t-sep"></div>
                <button class="t-btn" type="button" onmousedown="event.preventDefault(); exec('bold')"><b>B</b><span class="tlbl">Bold</span></button>
                <button class="t-btn" type="button" onmousedown="event.preventDefault(); exec('italic')"><i>I</i><span class="tlbl">Italic</span></button>
                <button class="t-btn" type="button" onmousedown="event.preventDefault(); exec('underline')"><u>U</u><span class="tlbl">Underline</span></button>
                <div class="t-sep"></div>
                <button class="t-btn" type="button" onmousedown="event.preventDefault(); applyHighlight()" style="color:#b45309;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/></svg>
                    <span class="tlbl">Highlight</span>
                </button>
                <div class="t-sep"></div>
                <button class="t-btn" type="button" onmousedown="event.preventDefault(); exec('justifyRight')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><line x1="21" y1="6" x2="3" y2="6"/><line x1="21" y1="12" x2="9" y2="12"/><line x1="21" y1="18" x2="3" y2="18"/></svg>
                    <span class="tlbl">Ø¯Ø§Ø¦ÛŒÚº</span>
                </button>
                <button class="t-btn" type="button" onmousedown="event.preventDefault(); exec('justifyFull')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><line x1="21" y1="6" x2="3" y2="6"/><line x1="21" y1="12" x2="3" y2="12"/><line x1="21" y1="18" x2="3" y2="18"/></svg>
                    <span class="tlbl">Ø¨Ø±Ø§Ø¨Ø±</span>
                </button>
                <div class="t-sep"></div>
                <div class="t-size">
                    <button type="button" onmousedown="event.preventDefault(); changeSize(-1)">âˆ’</button>
                    <input type="number" id="sizeInput" value="18" min="8" max="72" onkeypress="if(event.key==='Enter'){event.preventDefault();changeSize(0);}">
                    <button type="button" onmousedown="event.preventDefault(); changeSize(+1)">+</button>
                </div>
                <div class="t-sep"></div>
                <button class="t-btn" type="button" onmousedown="event.preventDefault(); triggerImg()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                    <span class="tlbl">ØªØµÙˆÛŒØ±</span>
                </button>
                <input type="file" id="imgInput" accept="image/*" style="display:none" onchange="handleImg(this)">
            </div>

            <div class="paper paper-font">
                <div class="paper-school" id="outSchool">Ø§Ø¯Ø§Ø±Û’ / ÛŒÙˆÙ†ÛŒÙˆØ±Ø³Ù¹ÛŒ Ú©Ø§ Ù†Ø§Ù…</div>
                <div id="metaContainer" class="paper-meta meta-container standard">
                    <div class="meta-row"><span class="meta-label">Ù…Ø¶Ù…ÙˆÙ†:</span><span class="meta-dash" id="outSubject">........................</span></div>
                    <div class="meta-row"><span class="meta-label">Ù†Ø§Ù…:</span><span class="meta-dash" id="outName">........................</span></div>
                    <div class="meta-row"><span class="meta-label">Ø¬Ù…Ø§Ø¹Øª:</span><span class="meta-dash" id="outSemester">........................</span></div>
                    <div class="meta-row"><span class="meta-label">Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±:</span><span class="meta-dash" id="outRoll">........................</span></div>
                    <div class="meta-row"><span class="meta-label">ØªØ§Ø±ÛŒØ®:</span><span class="meta-dash" id="outDate">........................</span></div>
                </div>
                <div class="paper-title" id="outTitle">Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ú©Ø§ Ø¹Ù†ÙˆØ§Ù†</div>
                <div id="paperEditor" contenteditable="true" spellcheck="false" oninput="handleInput('paper')"></div>
                <div class="paper-footer" id="paperFooter">ØªØ§Ø±ÛŒØ® | Ø§Ø¯Ø§Ø±Û</div>
            </div>
        </main>
    </div>

    <!-- Mobile nav (editor) -->
    <div class="mob-nav">
        <button class="mob-btn" type="button" onmousedown="toggleMobile('edit')" id="mobEdit">
            <svg viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
            <span>ØªØ±ØªÛŒØ¨Ø§Øª</span>
        </button>
        <button class="mob-btn active" type="button" onmousedown="toggleMobile('preview')" id="mobPrev">
            <svg viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            <span>ØµÙØ­Û</span>
        </button>
        <button class="mob-btn" type="button" onclick="openModal()">
            <svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            <span>PDF</span>
        </button>
        <button class="mob-btn" type="button" onclick="goBack()">
            <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>
            <span>ÙˆØ§Ù¾Ø³</span>
        </button>
    </div>
</div>

<!-- PRINT MODAL -->
<div class="modal-bg" id="printModal">
    <div class="modal-card">
        <div class="modal-title">ğŸ“„ PDF Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</div>
        <div class="modal-note">
            <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink:0;margin-top:1px"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
            <span>Print dialog Ù…ÛŒÚº <b>"Background graphics"</b> Ú©Ùˆ Ø¶Ø±ÙˆØ± Ú†ÛŒÚ© Ú©Ø±ÛŒÚº ØªØ§Ú©Û highlighting ØµØ­ÛŒØ­ Ø¢Ø¦Û’Û”</span>
        </div>
        <div class="modal-steps">
            1. Destination Ù…ÛŒÚº <b>"Save as PDF"</b> Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”<br>
            2. <b>Save</b> Ù¾Ø± Ú©Ù„Ú© Ú©Ø±ÛŒÚºÛ”
        </div>
        <div class="modal-btns">
            <button class="btn-cancel" onmousedown="closeModal()">Ù…Ù†Ø³ÙˆØ®</button>
            <button class="btn-go" onmousedown="doPrint()">Ù¾Ø±Ù†Ù¹ Ú©Ú¾ÙˆÙ„ÛŒÚº â†—</button>
        </div>
    </div>
</div>

<!-- DELETE CONFIRM MODAL -->
<div class="modal-bg" id="delModal">
    <div class="del-modal-card">
        <div class="del-icon">
            <svg viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>
        </div>
        <div class="del-title">Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ø­Ø°Ù Ú©Ø±ÛŒÚºØŸ</div>
        <div class="del-sub">ÛŒÛ Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ù…Ø³ØªÙ‚Ù„ Ø·ÙˆØ± Ù¾Ø± Ø­Ø°Ù ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯ÛŒÛ”<br>Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ</div>
        <div class="modal-btns" style="justify-content:center;">
            <button class="btn-cancel" onclick="closeDelModal()">Ø±ÛÙ†Û’ Ø¯ÛŒÚº</button>
            <button class="btn-del-confirm" onclick="confirmDelete()">ÛØ§ÚºØŒ Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
        </div>
    </div>
</div>

<div id="toast" class="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA LAYER
   Storage key: pdfNastaliq_docs â†’ array of docs
   Each doc: { id, docTitle, school, subject, name,
     semester, roll, date, footer, body, size, line,
     layout, createdAt, updatedAt, wordCount }
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const STORE_KEY = 'pdfNastaliq_docs';

function loadDocs() {
    try {
        const raw = localStorage.getItem(STORE_KEY);
        return raw ? JSON.parse(raw) : [];
    } catch(e) { return []; }
}

function saveDocs(docs) {
    try { localStorage.setItem(STORE_KEY, JSON.stringify(docs)); }
    catch(e) { showToast("Ø§Ø³Ù¹ÙˆØ±ÛŒØ¬ Ø¨Ú¾Ø± Ú¯Ø¦ÛŒ! ØªØµØ§ÙˆÛŒØ± ÛÙ¹Ø§Ø¦ÛŒÚºÛ”"); }
}

function makeId() { return 'doc_' + Date.now() + '_' + Math.random().toString(36).slice(2,7); }

// Migrate old single-doc format if it exists
function migrate() {
    const old = localStorage.getItem('urduApp_v5');
    if (!old) return;
    const docs = loadDocs();
    if (docs.length > 0) return; // already migrated
    try {
        const d = JSON.parse(old);
        if (d.body || d.inTitle) {
            docs.push({
                id: makeId(),
                docTitle: d.inTitle || 'Ù¾Ø±Ø§Ù†ÛŒ Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹',
                school: d.inSchool || '', subject: d.inSubject || '',
                name: d.inName || '', semester: d.inSemester || '',
                roll: d.inRoll || '', date: d.inDate || '',
                footer: d.footer || '', body: d.body || '',
                size: d.size || '18', line: d.line || '2.2',
                layout: d.layout || 'standard',
                createdAt: Date.now(), updatedAt: Date.now(),
                wordCount: countWords(d.body || '')
            });
            saveDocs(docs);
        }
    } catch(e) {}
}

function countWords(html) {
    const tmp = document.createElement('div');
    tmp.innerHTML = html;
    const txt = (tmp.innerText || '').trim();
    return txt ? txt.split(/\s+/).filter(w=>w.length).length : 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentDocId = null;
let pendingDeleteId = null;
let _saveTimer = null;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openDoc(id) {
    currentDocId = id;
    const docs = loadDocs();
    const doc  = docs.find(d => d.id === id);
    if (!doc) { renderDash(); return; }

    // Populate editor
    document.getElementById('docTitleInput').value      = doc.docTitle || '';
    document.getElementById('inSchool').value            = doc.school    || '';
    document.getElementById('inSubject').value           = doc.subject   || '';
    document.getElementById('inName').value              = doc.name      || '';
    document.getElementById('inSemester').value          = doc.semester  || '';
    document.getElementById('inRoll').value              = doc.roll      || '';
    document.getElementById('inDate').value              = doc.date      || '';
    document.getElementById('inTitle').value             = doc.docTitle  || '';
    document.getElementById('inFooter').value            = doc.footer    || '';
    document.getElementById('paperEditor').innerHTML     = doc.body      || '';
    document.getElementById('sidebarEditor').innerHTML   = doc.body      || '';
    document.getElementById('sizeRange').value           = doc.size      || '18';
    document.getElementById('lineRange').value           = doc.line      || '2.2';
    document.getElementById('headerLayoutSelect').value  = doc.layout    || 'standard';

    updateHeaderLayout();
    updateBaseSettings();
    syncMeta();
    updateStats();
    setAutosave('saved');

    document.body.classList.add('in-editor');
    // scroll editor canvas to top
    setTimeout(() => {
        const canvas = document.querySelector('.e-canvas');
        if (canvas) canvas.scrollTop = 0;
    }, 420);
}

function goBack() {
    saveNow();
    document.body.classList.remove('in-editor');
    setTimeout(renderDash, 100);
}

function newDoc() {
    const docs = loadDocs();
    const doc = {
        id: makeId(),
        docTitle: '', school: '', subject: '', name: '',
        semester: '', roll: '', date: '', footer: '', body: '',
        size: '18', line: '2.2', layout: 'standard',
        createdAt: Date.now(), updatedAt: Date.now(), wordCount: 0
    };
    docs.unshift(doc);
    saveDocs(docs);
    openDoc(doc.id);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderDash() {
    const docs   = loadDocs();
    const scroll = document.getElementById('dashScroll');

    if (docs.length === 0) {
        scroll.innerHTML = `
        <div class="empty-state">
            <div class="empty-icon">
                <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
            </div>
            <div class="empty-title">Ø§Ø¨Ú¾ÛŒ ØªÚ© Ú©ÙˆØ¦ÛŒ Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ù†ÛÛŒÚº</div>
            <div class="empty-sub">Ø§ÙˆÙ¾Ø± ÙˆØ§Ù„Û’ Ø¨Ù¹Ù† Ø³Û’ Ù†Ø¦ÛŒ Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº</div>
        </div>
        ${seoHTML()}`;
        return;
    }

    const cards = docs.map((doc, i) => {
        const subj    = doc.subject || doc.docTitle || '';
        const title   = doc.docTitle || doc.subject || '';
        const school  = doc.school || '';
        const wc      = doc.wordCount || 0;
        const dt      = doc.date || '';
        const ago     = timeAgo(doc.updatedAt);
        const isUntitled = !title;

        return `
        <div class="doc-card" style="animation-delay:${i * 50}ms" onclick="openDoc('${doc.id}')">
            <div class="doc-card-top">
                <span class="doc-subject-chip">${escHtml(subj || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†')}</span>
                <button class="doc-menu-btn" onclick="event.stopPropagation(); promptDelete('${doc.id}')" title="Ø­Ø°Ù Ú©Ø±ÛŒÚº">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/></svg>
                </button>
            </div>
            <div class="doc-title ${isUntitled ? 'untitled' : ''}">${escHtml(title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†')}</div>
            ${school ? `<div class="doc-school">${escHtml(school)}</div>` : ''}
            <div class="doc-card-bottom">
                <div class="doc-meta-chips">
                    ${dt ? `<span class="doc-chip">${escHtml(dt)}</span>` : ''}
                    <span class="doc-chip">${wc} Ø§Ù„ÙØ§Ø¸</span>
                    <span class="doc-chip">${ago}</span>
                </div>
                <button class="doc-open-btn" onclick="event.stopPropagation(); openDoc('${doc.id}')">Ú©Ú¾ÙˆÙ„ÛŒÚº</button>
            </div>
        </div>`;
    }).join('');

    scroll.innerHTML = `
        <p class="dash-section-title">Ù…ÛŒØ±ÛŒ Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ÛŒÚº (${docs.length})</p>
        <div class="doc-grid">${cards}</div>
        ${seoHTML()}`;
}

function seoHTML() {
    return `
    <section class="seo-block" aria-label="About PDF Nastaliq">
        <h2>PDF Nastaliq â€” Free Online Urdu Assignment Maker</h2>
        <p>A free browser-based tool for students who write assignments in Urdu. Type in authentic <strong>Nastaliq font</strong>, fill in your details, and export a clean <strong>A4 PDF</strong> instantly â€” no account needed.</p>
        <div class="seo-grid">
            <div class="seo-item"><div class="seo-dot"></div><span>Noto Nastaliq Urdu â€” the clearest Urdu script in print</span></div>
            <div class="seo-item"><div class="seo-dot"></div><span>Multiple documents â€” manage all your assignments in one place</span></div>
            <div class="seo-item"><div class="seo-dot"></div><span>Auto-saves to browser â€” your work is never lost</span></div>
            <div class="seo-item"><div class="seo-dot"></div><span>Correct A4 margins â€” prints exactly as shown</span></div>
            <div class="seo-item"><div class="seo-dot"></div><span>Works on mobile &amp; desktop</span></div>
            <div class="seo-item"><div class="seo-dot"></div><span>100% free â€” no ads, no signup, no watermark</span></div>
        </div>
        <p class="seo-urdu">PDF Nastaliq Ø§ÛŒÚ© Ù…ÙØª Ø¢Ù† Ù„Ø§Ø¦Ù† Ø§Ø±Ø¯Ùˆ Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ø³Ø§Ø² ÛÛ’Û” Ù†Ø³ØªØ¹Ù„ÛŒÙ‚ ÙÙˆÙ†Ù¹ Ù…ÛŒÚº Ù„Ú©Ú¾ÛŒÚºØŒ Ù…ØªØ¹Ø¯Ø¯ Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ÛŒÚº Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚºØŒ Ø§ÙˆØ± A4 PDF ÙÙˆØ±ÛŒ Ø¨Ù†Ø§Ø¦ÛŒÚº â€” Ø¨Ø§Ù„Ú©Ù„ Ù…ÙØªØŒ Ú©ÙˆØ¦ÛŒ Ø§Ú©Ø§Ø¤Ù†Ù¹ Ù†ÛÛŒÚºÛ”</p>
        <div style="margin-top:14px;padding-top:14px;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;">
            <span style="font-size:0.78rem;color:var(--ink3);">Â© 2024 PDF Nastaliq &nbsp;Â·&nbsp; Your data stays on your device</span>
            <a href="privacy.html" style="font-size:0.78rem;font-weight:600;color:var(--green-dk);text-decoration:none;display:inline-flex;align-items:center;gap:5px;background:var(--green-pl);border:1px solid var(--green-lt);padding:4px 13px;border-radius:var(--r-pill);">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                Privacy Policy
            </a>
        </div>
    </section>`;
}

function escHtml(str) {
    return (str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function timeAgo(ts) {
    if (!ts) return '';
    const mins = Math.floor((Date.now() - ts) / 60000);
    if (mins < 1)  return 'Ø§Ø¨Ú¾ÛŒ';
    if (mins < 60) return `${mins} Ù…Ù†Ù¹ Ù¾ÛÙ„Û’`;
    const hrs = Math.floor(mins / 60);
    if (hrs < 24)  return `${hrs} Ú¯Ú¾Ù†Ù¹Û’ Ù¾ÛÙ„Û’`;
    const days = Math.floor(hrs / 24);
    return `${days} Ø¯Ù† Ù¾ÛÙ„Û’`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DELETE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function promptDelete(id) {
    pendingDeleteId = id;
    document.getElementById('delModal').classList.add('show');
}
function closeDelModal() {
    pendingDeleteId = null;
    document.getElementById('delModal').classList.remove('show');
}
function confirmDelete() {
    if (!pendingDeleteId) return;
    let docs = loadDocs();
    docs = docs.filter(d => d.id !== pendingDeleteId);
    saveDocs(docs);
    closeDelModal();
    renderDash();
    showToast("Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ø­Ø°Ù Ú©Ø± Ø¯ÛŒ Ú¯Ø¦ÛŒ");
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EDITOR LOGIC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const metaFields = [
    { in:'inSchool',   out:'outSchool',   def:'Ø§Ø¯Ø§Ø±Û’ / ÛŒÙˆÙ†ÛŒÙˆØ±Ø³Ù¹ÛŒ Ú©Ø§ Ù†Ø§Ù…' },
    { in:'inSubject',  out:'outSubject',  def:'........................' },
    { in:'inName',     out:'outName',     def:'........................' },
    { in:'inSemester', out:'outSemester', def:'........................' },
    { in:'inRoll',     out:'outRoll',     def:'........................' },
    { in:'inDate',     out:'outDate',     def:'........................' },
    { in:'inTitle',    out:'outTitle',    def:'Ø§Ø³Ø§Ø¦Ù†Ù…Ù†Ù¹ Ú©Ø§ Ø¹Ù†ÙˆØ§Ù†' }
];

function onDocTitleInput() {
    const val = document.getElementById('docTitleInput').value;
    document.getElementById('inTitle').value = val;
    syncMeta();
}

function handleInput(src) {
    const paper   = document.getElementById('paperEditor');
    const sidebar = document.getElementById('sidebarEditor');
    if (src === 'sidebar') paper.innerHTML = sidebar.innerHTML;
    else sidebar.innerHTML = paper.innerHTML;
    updateStats();
    saveDebounced();
}

function syncMeta() {
    metaFields.forEach(f => {
        const v = document.getElementById(f.in).value;
        document.getElementById(f.out).innerText = v || f.def;
    });
    const custom = document.getElementById('inFooter').value;
    const school = document.getElementById('inSchool').value;
    const date   = document.getElementById('inDate').value;
    document.getElementById('paperFooter').innerText =
        custom || (date && school ? `${date} | ${school}` : date || school || 'ØªØ§Ø±ÛŒØ® | Ø§Ø¯Ø§Ø±Û');
    saveDebounced();
}

function updateHeaderLayout() {
    const layout = document.getElementById('headerLayoutSelect').value;
    const c = document.getElementById('metaContainer');
    c.classList.remove('standard','simple');
    c.classList.add(layout);
    saveDebounced();
}

function updateBaseSettings() {
    const s = document.getElementById('sizeRange').value;
    const l = document.getElementById('lineRange').value;
    document.getElementById('sizeVal').innerText  = s + 'px';
    document.getElementById('lineVal').innerText  = l;
    document.getElementById('sizeInput').value    = s;
    document.documentElement.style.setProperty('--base-size', s + 'px');
    document.documentElement.style.setProperty('--base-lh', l);
    saveDebounced();
}

function exec(cmd) {
    document.execCommand(cmd);
    document.getElementById('paperEditor').focus();
    saveDebounced();
}

/* Fixed font size: uses DOM range, no execCommand insertHTML */
function changeSize(delta) {
    const sel = window.getSelection();
    if (!sel || sel.rangeCount === 0) return;
    const range = sel.getRangeAt(0);

    if (range.collapsed) {
        const input = document.getElementById('sizeInput');
        let v = Math.min(72, Math.max(8, (parseInt(input.value) || 18) + delta));
        input.value = v;
        if (delta !== 0) showToast("Ù¾ÛÙ„Û’ Ù…ØªÙ† Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº");
        return;
    }

    const input   = document.getElementById('sizeInput');
    const newSize = delta === 0
        ? Math.min(72, Math.max(8, parseInt(input.value) || 18))
        : Math.min(72, Math.max(8, (parseInt(input.value) || 18) + delta));
    input.value = newSize;

    const fragment = range.extractContents();
    const span = document.createElement('span');
    span.style.fontSize   = newSize + 'px';
    span.style.fontFamily = "'Noto Nastaliq Urdu', serif";
    span.appendChild(fragment);
    range.insertNode(span);

    const newRange = document.createRange();
    newRange.selectNodeContents(span);
    sel.removeAllRanges();
    sel.addRange(newRange);

    saveDebounced();
}

function applyHighlight() {
    const parent = window.getSelection()?.anchorNode?.parentElement;
    if (!parent) return;
    const bg = parent.style.backgroundColor;
    document.execCommand('hiliteColor', false,
        (bg === 'rgb(254, 240, 138)' || bg === '#fef08a') ? 'transparent' : '#fef08a');
    saveDebounced();
}

function triggerImg() { document.getElementById('imgInput').click(); }
function handleImg(input) {
    if (!input.files?.[0]) return;
    if (input.files[0].size > 1000000) showToast("ØªØµÙˆÛŒØ± Ø¨Ú‘ÛŒ ÛÛ’ â€” Ø§Ø³Ù¹ÙˆØ±ÛŒØ¬ Ø¬Ù„Ø¯ÛŒ Ø¨Ú¾Ø± Ø³Ú©ØªÛŒ ÛÛ’", 3000);
    const reader = new FileReader();
    reader.onload = e => { document.execCommand('insertImage', false, e.target.result); saveDebounced(); };
    reader.readAsDataURL(input.files[0]);
}

function setToday() {
    document.getElementById('inDate').value =
        new Intl.DateTimeFormat('ur-PK', { year:'numeric', month:'long', day:'numeric' }).format(new Date());
    syncMeta();
}

function updateStats() {
    const txt = document.getElementById('paperEditor').innerText || '';
    const words = txt.trim().split(/\s+/).filter(w => w.length).length;
    document.getElementById('wordCount').innerText = words;
    document.getElementById('charCount').innerText = txt.length;
}

function clearContent() {
    if (!confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø³Ø¨Ú¾ÛŒ Ù…ÙˆØ§Ø¯ ØµØ§Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) return;
    document.getElementById('paperEditor').innerHTML = '';
    document.getElementById('sidebarEditor').innerHTML = '';
    updateStats(); saveNow();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setAutosave(state) {
    const el = document.getElementById('autosaveBadge');
    el.className = 'autosave-badge ' + state;
    el.innerHTML = state === 'saving'
        ? '<span class="autosave-dot"></span> Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ø±ÛØ§ ÛÛ’...'
        : '<span class="autosave-dot"></span> Ù…Ø­ÙÙˆØ¸ ÛÛ’';
}

function saveDebounced() {
    setAutosave('saving');
    clearTimeout(_saveTimer);
    _saveTimer = setTimeout(saveNow, 900);
}

function saveNow() {
    if (!currentDocId) return;
    const docs = loadDocs();
    const idx  = docs.findIndex(d => d.id === currentDocId);
    if (idx === -1) return;

    const body = document.getElementById('paperEditor').innerHTML;
    docs[idx] = {
        ...docs[idx],
        docTitle:  document.getElementById('docTitleInput').value,
        school:    document.getElementById('inSchool').value,
        subject:   document.getElementById('inSubject').value,
        name:      document.getElementById('inName').value,
        semester:  document.getElementById('inSemester').value,
        roll:      document.getElementById('inRoll').value,
        date:      document.getElementById('inDate').value,
        footer:    document.getElementById('inFooter').value,
        body,
        size:      document.getElementById('sizeRange').value,
        line:      document.getElementById('lineRange').value,
        layout:    document.getElementById('headerLayoutSelect').value,
        updatedAt: Date.now(),
        wordCount: countWords(body)
    };
    saveDocs(docs);
    setAutosave('saved');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR & MOBILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleEditorSidebar() {
    const sb = document.getElementById('eSidebar');
    sb.style.display = (sb.style.display === 'none') ? 'flex' : 'none';
}

function toggleMobile(mode) {
    const sb   = document.getElementById('eSidebar');
    const bd   = document.getElementById('eBackdrop');
    const edit = document.getElementById('mobEdit');
    const prev = document.getElementById('mobPrev');
    if (mode === 'edit') {
        sb.style.display = 'flex'; void sb.offsetWidth;
        sb.style.transform = 'translateX(0)';
        bd.classList.add('show');
        edit.classList.add('active'); prev.classList.remove('active');
    } else {
        sb.style.transform = 'translateX(100%)';
        bd.classList.remove('show');
        setTimeout(() => { if (window.innerWidth <= 860) sb.style.display = 'none'; }, 300);
        edit.classList.remove('active'); prev.classList.add('active');
    }
}

window.onresize = () => {
    const sb = document.getElementById('eSidebar');
    if (window.innerWidth > 860) {
        sb.style.display = 'flex'; sb.style.transform = 'none';
        document.getElementById('eBackdrop').classList.remove('show');
    } else if (!document.getElementById('eBackdrop').classList.contains('show')) {
        sb.style.display = 'none';
    }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRINT MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const modal = document.getElementById('printModal');
function openModal()  { modal.classList.add('show'); }
function closeModal() { modal.classList.remove('show'); }
function doPrint()    { closeModal(); setTimeout(() => window.print(), 300); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showToast(msg, dur=2200) {
    const t = document.getElementById('toast');
    t.innerText = msg; t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), dur);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.onload = function() {
    migrate();
    renderDash();
};
</script>
</body>
</html>
